<!DOCTYPE html>
<html>

<head>
    <style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    
    #map {
        height: 100%;
    }
    </style>
</head>

<body>
    <div id="map"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript">
            var map;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {
                    lat: 40.7127,
                    lng: -74.0059
                },
                zoom: 2
            });
        }
    $(document).ready(function() {
        // pass in an object that setup the ajax call and handle the success/error responses
        console.log("start");
        $.ajax({
            url: "https://api.instagram.com/v1/tags/travel/media/recent?access_token=2339943.1fb234f.44384f3946ff44cb83a3068374578484",
            type: "GET",
            crossDomain: true, // used to prevent cross domain issues
            dataType: 'jsonp', // used to prevent cross domain issues
            success: function(response) {
                // The request succeeded
                console.log("success");
                parseInstagramData(response);
            },
            error: function(xhr, status) {
                // The request failed
                console.log("fail");
                console.log(status);
            }
        });

        function parseInstagramData(json) {
            console.log(json);
            $.each(json.data, function(key, val) {
            	if (!val.location)
            		return;
                var photo = val.images.standard_resolution.url;
                var user = val.user.profile_picture;
                var username = val.user.username;
                var contentString = $('<li><img src="' + photo + '"/><img src="' + user + '"/>' + username + '</li>').html();
                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });

                var marker = new google.maps.Marker({
                    position: {
                        lat: val.location.latitude,
                        lng: val.location.longitude
                    },
                    map: map,
                    title: val.caption.text
                });
                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });
            });
        }
    });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyRWbbK93Bnku_ecbCQFvP5_jiSGwAJ3M&callback=initMap">
    </script>
</body>
</html>
